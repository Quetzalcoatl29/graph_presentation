<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Labs</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <script src="/resources/node_modules/cytoscape/dist/cytoscape.min.js"></script>
    <script src="/resources/cytoscape-spread.js"></script>

    <style>
        #graph-container {
          max-width: 100%;
          height: 800px;
          margin: auto;
          border-style: solid;
          border-color: red;
        }

        #control {
          padding: 1.5rem;
          margin-right: 0;
          margin-left: 0;
          border-width: .2rem;
        }
    </style>
  </head>
  <body>
    <div id="container">
      <div class="row">
        <div class="col-md-4">
          <div id="control">
            <div class="form-row">
              <div class="form-group">
                <label for="num-nodes">Nodes Length</label>
                <input type="number" class="form-control" id="num-nodes" value="10">
              </div>
              <div class="form-group">
                <label for="num-edges">Edges Probability</label>
                <input type="number" class="form-control" id="pro-edges" value="0.8">
              </div>
              <div class="form-group">
                <button class="btn btn-primary" id="btn-load">Load</button>
              </div>
            </div>
          </div>
        </div>

      </div>
      <div class="row">
        <div class="col-md-11" id="draw-container">
          <div id="graph-container"></div>
        </div>
      </div>
    </div>
  </body>

  <script>
    var graph_render = null;
    var graph_container = 'graph-container';
    var draw_container = 'draw-container';

    $("#btn-load").click(function(){
      num_nodes = $("#num-nodes").val();
      pro_edges = $("#pro-edges").val();

      load_graph(num_nodes, pro_edges);
    });

    function load_graph(num_nodes, pro_edges) {
      $.ajax({
          method: "POST",
          url: "http://127.0.0.1:5000/graph/create",
          dataType: "json",
          contentType: "application/json; charset=utf-8",
          data: JSON.stringify({
             "num_nodes": parseInt(num_nodes),
             "probability_edges": parseFloat(pro_edges)
          })
      })
      .done(function( data_for_load_graph ) {
        console.log( "Done!" );
        console.log( data_for_load_graph );

        create_graph( data_for_load_graph );
      })
      .fail(function( jqXHR, textStatus ) {
        alert( "Request failed: " + textStatus );
      });
    }

    function create_graph(data_for_load_graph) {
      refresh_graph();

      graph_render = cytoscape({
        container: document.getElementById(graph_container),
        elements: data_for_load_graph,
        layout: {
						name: 'spread',
						minDist: 40
				},
        style: [
          {
            selector: 'node',
            style: {
              'label': 'data(id)',
              'text-valign': 'center',
              'color': '#000000',
              'background-color': '#3a7ecf'
            }
          },

          {
            selector: 'edge',
            style: {
              'width': 2,
              'line-color': '#3a7ecf',
              'opacity': 0.5
            }
          }
        ]
      });
    }

    function refresh_graph() {
      $('#' + graph_container).remove();
      $('#' + draw_container).html('<div id="'+graph_container+'"></div>');
    }


  </script>
</html>
